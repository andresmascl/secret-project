services:
  scrapbot:
    build: .
    container_name: scrapbot-ai
    # Network host mode helps with PulseAudio socket communication
    network_mode: host
    privileged: true 
    devices:
      - "/dev/snd:/dev/snd"
    volumes:
      # Maps the PulseAudio socket
      - /run/user/1000/pulse:/run/user/1000/pulse
      - /var/lib/dbus:/var/lib/dbus
      # Maps your local environment and code for live-reloading/persistence
      - ./.env:/app/.env
      - .:/app
    environment:
      - PULSE_SERVER=unix:/run/user/1000/pulse/native
      # Tells Python not to buffer logs so you see the Mic Level in real-time
      - PYTHONUNBUFFERED=1 
    group_add:
      - audio
    restart: unless-stopped